<!DOCTYPE html>
<html lang="zh-CN" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ã€Š{{ page.title }}ã€‹- äº¤äº’å¼æ­Œè¯è§£æ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    
    {% assign theme_bg = page.theme.background | default: '#fdf6e3' %}
    {% assign theme_text = page.theme.text | default: '#657b83' %}
    {% assign theme_primary = page.theme.primary | default: '#073642' %}
    {% assign theme_accent = page.theme.accent | default: theme_primary %}
    {% assign theme_secondary = page.theme.secondary | default: theme_primary %}

    <style>
        body {
            font-family: 'Noto Sans SC', sans-serif;
            background-color: {{ theme_bg }};
            color: {{ theme_text }};
        }
        .chart-container {
            position: relative;
            width: 100%;
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
            height: 350px;
            max-height: 400px;
        }
        @media (min-width: 768px) {
            .chart-container {
                height: 400px;
            }
        }
        .nav-link {
            transition: all 0.3s ease;
            color: {{ theme_text }};
            border-bottom-width: 2px;
            border-color: transparent;
            opacity: 0.8;
        }
        .nav-link.active, .nav-link:hover {
            color: {{ theme_accent }};
            border-color: {{ theme_accent }};
            opacity: 1;
        }
        .lyric-item {
            background-color: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0,0,0,0.05);
            transition: all 0.3s ease;
        }
        .lyric-item:hover {
             border-left: 4px solid {{ theme_accent }};
             box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1), 0 2px 4px -2px rgb(0 0 0 / 0.1);
        }
        .lyric-header {
            cursor: pointer;
        }
        .lyric-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.5s ease-in-out, padding 0.5s ease-in-out;
            padding-top: 0;
            padding-bottom: 0;
        }
        .lyric-content.open {
            max-height: 500px;
            padding-top: 1rem;
            padding-bottom: 1rem;
        }
        .vocab-card {
            perspective: 1000px;
        }
        .vocab-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            text-align: center;
            transition: transform 0.6s;
            transform-style: preserve-3d;
        }
        .vocab-card.is-flipped .vocab-card-inner {
            transform: rotateY(180deg);
        }
        .vocab-card-front, .vocab-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            -webkit-backface-visibility: hidden;
            backface-visibility: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 0.5rem;
            padding: 1rem;
        }
        .vocab-card-front {
            background-color: rgba(0,0,0,0.05);
            color: {{ theme_text }};
        }
        .vocab-card-back {
            background-color: {{ theme_accent }};
            color: #ffffff;
            transform: rotateY(180deg);
            flex-direction: column;
        }
        rt {
            font-size: 0.8em;
            color: {{ theme_text }};
            opacity: 0.7;
        }
    </style>
</head>
<body class="antialiased">
    <div class="container mx-auto px-4 py-8 max-w-5xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold" style="color: {{ theme_primary }};">{{ page.title }}</h1>
            <p class="text-lg mt-2" style="color: {{ theme_text }};">{{ page.artist }} - äº¤äº’å¼æ­Œè¯ä¸ä¸»é¢˜æ·±åº¦è§£æ</p>
        </header>

        <nav class="sticky top-0 bg-white/80 backdrop-blur-md z-10 mb-12 shadow-sm rounded-lg">
            <ul class="flex justify-center items-center -mb-px space-x-4 md:space-x-8 text-base md:text-lg p-2">
                <li><a href="#overview" class="nav-link inline-block py-3 px-2">æ­Œæ›²æ¦‚è§ˆ</a></li>
                <li><a href="#lyrics" class="nav-link inline-block py-3 px-2">äº¤äº’æ­Œè¯</a></li>
                <li><a href="#themes" class="nav-link inline-block py-3 px-2">ä¸»é¢˜æ¢ç´¢</a></li>
                <li><a href="#vocabulary" class="nav-link inline-block py-3 px-2">æ ¸å¿ƒè¯æ±‡</a></li>
            </ul>
        </nav>

        <main>
            <!-- Section 1: Overview -->
            <section id="overview" class="mb-16 scroll-mt-24">
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4" style="color: {{ theme_secondary }};">{{ page.intro_title }}</h2>
                    <p class="text-gray-700 leading-relaxed mb-6">{{ page.intro_content }}</p>

                    <h3 class="text-xl font-bold mb-4" style="color: {{ theme_accent }};">æ ¸å¿ƒä¸»é¢˜å¯è§†åŒ–</h3>
                    <p class="text-gray-700 leading-relaxed mb-6">{{ page.chart.description | default: "ä¸‹æ–¹çš„å›¾è¡¨ç›´è§‚åœ°å±•ç¤ºäº†æ­Œæ›²ä¸­å‡ ä¸ªå…³é”®ä¸»é¢˜ä¹‹é—´çš„å…³ç³»ä¸å¼ åŠ›ã€‚" }}</p>
                    <div class="chart-container">
                        <canvas id="themeChart"></canvas>
                    </div>
                </div>
            </section>

            <!-- Section 2: Interactive Lyrics -->
            <section id="lyrics" class="mb-16 scroll-mt-24">
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4" style="color: {{ theme_secondary }};">äº¤äº’å¼æ­Œè¯è§£æ</h2>
                    <p class="text-gray-700 leading-relaxed mb-6">æœ¬åŒºåŸŸå°†æ­Œæ›²çš„å®Œæ•´æ­Œè¯åˆ†è§£ä¸ºå¯äº¤äº’çš„æ®µè½ã€‚è¯·ç‚¹å‡»ä»»æ„ä¸€å¥æ­Œè¯ï¼Œå³å¯å±•å¼€æˆ–æŠ˜å å…¶å¯¹åº”çš„å‡åæ³¨éŸ³åŠæ·±åº¦è§£è¯»ã€‚</p>
                    <div id="lyrics-container" class="space-y-3"></div>
                </div>
            </section>

            <!-- Section 3: Theme Explorer -->
            <section id="themes" class="mb-16 scroll-mt-24">
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4" style="color: {{ theme_secondary }};">ä¸»é¢˜æ¢ç´¢</h2>
                     <p class="text-gray-700 leading-relaxed mb-6">ç‚¹å‡»ä¸‹æ–¹å¡ç‰‡ï¼Œæ·±å…¥äº†è§£æ¯ä¸ªä¸»é¢˜çš„å†…æ¶µã€‚</p>
                    <div id="themes-container" class="grid grid-cols-1 md:grid-cols-2 gap-6"></div>
                </div>
            </section>

            <!-- Section 4: Core Vocabulary -->
            <section id="vocabulary" class="scroll-mt-24">
                <div class="bg-white p-6 md:p-8 rounded-xl shadow-md border border-gray-200">
                    <h2 class="text-2xl font-bold mb-4" style="color: {{ theme_secondary }};">æ ¸å¿ƒè¯æ±‡å­¦ä¹ </h2>
                    <p class="text-gray-700 leading-relaxed mb-6">ç‚¹å‡»ä»»æ„å¡ç‰‡å³å¯â€œç¿»è½¬â€æŸ¥çœ‹å…¶è¯»éŸ³å’Œä¸­æ–‡é‡Šä¹‰ã€‚</p>
                    <div id="vocab-container" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 gap-4"></div>
                </div>
            </section>
        </main>
        <footer class="text-center mt-12 text-gray-500 text-sm">
            <p>äº¤äº’å¼åº”ç”¨æ ¹æ® {{ page.artist }}ã€Š{{ page.title }}ã€‹æ·±åº¦è§£ææŠ¥å‘Šç”Ÿæˆã€‚</p>
            <p>&copy; {{ 'now' | date: "%Y" }} - äº¤äº’å¼å­¦ä¹ ä½“éªŒ</p>
        </footer>
    </div>

    <script>
        // Prepare Data from Jekyll Front Matter
        const appData = {
            lyrics: {{ page.lyrics | jsonify }},
            themes: {{ page.themes | jsonify }},
            vocabulary: {{ page.vocabulary | jsonify }},
            chart: {{ page.chart | jsonify }}
        };

        document.addEventListener('DOMContentLoaded', () => {
            // 1. Navigation Highlighting
            const sections = document.querySelectorAll('main section');
            const navLinks = document.querySelectorAll('.nav-link');

            function updateActiveLinkOnScroll() {
                let currentSection = '';
                sections.forEach(section => {
                    const sectionTop = section.offsetTop;
                    if (pageYOffset >= sectionTop - 150) {
                        currentSection = section.getAttribute('id');
                    }
                });

                navLinks.forEach(link => {
                    link.classList.remove('active');
                    if (link.getAttribute('href') === `#${currentSection}`) {
                        link.classList.add('active');
                    }
                });
            }
            window.addEventListener('scroll', updateActiveLinkOnScroll);

            // 2. Render Lyrics
            const lyricsContainer = document.getElementById('lyrics-container');
            if (lyricsContainer && appData.lyrics) {
                lyricsContainer.innerHTML = appData.lyrics.map((line, index) => `
                    <div class="lyric-item rounded-lg shadow-sm">
                        <div class="lyric-header p-4 flex justify-between items-center" onclick="toggleLyric(${index})">
                            <p class="text-md md:text-lg text-gray-800">${line.lyric}</p>
                            <span id="icon-${index}" class="text-gray-400 transform transition-transform duration-300">â–¼</span>
                        </div>
                        <div id="content-${index}" class="lyric-content px-4 border-t border-gray-200">
                             <div class="mb-2">
                                <span class="text-sm font-mono text-gray-500 block">æ³¨éŸ³ï¼š${line.furigana || ''}</span>
                            </div>
                            <div class="mb-3">
                                <span class="text-gray-700 font-semibold block">ç¿»è¯‘ï¼š${line.translation || ''}</span>
                            </div>
                            <p class="text-gray-600 text-sm leading-relaxed">${line.explanation || ''}</p>
                        </div>
                    </div>
                `).join('');
            }

            // 3. Render Themes
            const themesContainer = document.getElementById('themes-container');
            if (themesContainer && appData.themes) {
                themesContainer.innerHTML = appData.themes.map(theme => `
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-100 hover:shadow-md transition-shadow">
                        <div class="flex items-center mb-3">
                            <span class="text-2xl mr-3">${theme.icon || 'ğŸ“Œ'}</span>
                            <h3 class="text-lg font-bold text-gray-800">${theme.title}</h3>
                        </div>
                        <p class="text-gray-600 text-sm leading-relaxed">${theme.content}</p>
                    </div>
                `).join('');
            }

            // 4. Render Vocabulary
            const vocabContainer = document.getElementById('vocab-container');
            if (vocabContainer && appData.vocabulary) {
                vocabContainer.innerHTML = appData.vocabulary.map((vocab, index) => `
                    <div class="vocab-card h-32 cursor-pointer" onclick="this.classList.toggle('is-flipped')">
                        <div class="vocab-card-inner">
                            <div class="vocab-card-front shadow-sm border border-gray-200">
                                <span class="text-lg font-bold">${vocab.word}</span>
                            </div>
                            <div class="vocab-card-back shadow-sm rounded-lg">
                                <span class="text-sm mb-1">${vocab.reading}</span>
                                <span class="text-xs font-semibold px-2 text-center">${vocab.meaning}</span>
                            </div>
                        </div>
                    </div>
                `).join('');
            }

            // 5. Render Chart
            const ctx = document.getElementById('themeChart');
            if (ctx && appData.chart) {
                new Chart(ctx, {
                    type: appData.chart.type || 'radar',
                    data: {
                        labels: appData.chart.labels,
                        datasets: appData.chart.datasets
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { position: 'bottom' }
                        },
                        scales: appData.chart.type === 'bar' ? {
                            y: { beginAtZero: true, max: 100 }
                        } : {
                            r: {
                                angleLines: { display: true },
                                suggestedMin: 0,
                                suggestedMax: 100
                            }
                        }
                    }
                });
            }
        });

        // Helper for lyrics toggle
        function toggleLyric(index) {
            const content = document.getElementById(`content-${index}`);
            const icon = document.getElementById(`icon-${index}`);
            
            if (content.classList.contains('open')) {
                content.classList.remove('open');
                icon.style.transform = 'rotate(0deg)';
            } else {
                // Close others (optional - can be removed if multiple open allowed)
                document.querySelectorAll('.lyric-content.open').forEach(el => {
                   el.classList.remove('open');
                });
                document.querySelectorAll('.lyric-header span').forEach(el => {
                   el.style.transform = 'rotate(0deg)';
                });

                content.classList.add('open');
                icon.style.transform = 'rotate(180deg)';
            }
        }
    </script>
</body>
</html>
